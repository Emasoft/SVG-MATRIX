<?xml version="1.0" encoding="UTF-8"?>
<!--
  Test SVG: Marker with non-zero viewBox origin

  This tests the correct handling of markers where the viewBox has a non-zero origin.

  Marker specification:
  - viewBox="10 20 100 100" (origin at 10,20 with 100x100 size)
  - refX=60, refY=70 (center of viewBox: 10+50=60, 20+50=70)
  - markerWidth=20, markerHeight=20 (final size in user space)

  Expected behavior:
  - The marker's reference point (60,70 in viewBox coords) should align with the path endpoint
  - The viewBox origin offset (10,20) must be accounted for in the transform
  - Scale factor = 20/100 = 0.2 (markerWidth/viewBoxWidth)

  Path endpoint is at (200, 100).
  The red reference circle at (200, 100) shows where the marker center should land.
-->
<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300" viewBox="0 0 400 300">
  <defs>
    <!--
      Marker with non-zero viewBox origin
      viewBox starts at (10, 20), not (0, 0)
      The circle is at the center of the viewBox: (10+50, 20+50) = (60, 70)
      refX/refY point to this center
    -->
    <marker id="centerMarker"
            viewBox="10 20 100 100"
            refX="60"
            refY="70"
            markerWidth="20"
            markerHeight="20"
            markerUnits="userSpaceOnUse"
            orient="0">
      <!-- Circle at center of viewBox (60, 70) -->
      <circle cx="60" cy="70" r="40" fill="blue" opacity="0.7"/>
      <!-- Cross-hairs to show exact center -->
      <line x1="60" y1="30" x2="60" y2="110" stroke="white" stroke-width="2"/>
      <line x1="20" y1="70" x2="100" y2="70" stroke="white" stroke-width="2"/>
    </marker>

    <!--
      Reference marker with viewBox at origin (0,0) for comparison
      This should behave identically if viewBox offset is handled correctly
    -->
    <marker id="originMarker"
            viewBox="0 0 100 100"
            refX="50"
            refY="50"
            markerWidth="20"
            markerHeight="20"
            markerUnits="userSpaceOnUse"
            orient="0">
      <circle cx="50" cy="50" r="40" fill="green" opacity="0.7"/>
      <line x1="50" y1="10" x2="50" y2="90" stroke="white" stroke-width="2"/>
      <line x1="10" y1="50" x2="90" y2="50" stroke="white" stroke-width="2"/>
    </marker>
  </defs>

  <!-- Background grid for reference -->
  <g stroke="#ddd" stroke-width="0.5">
    <line x1="0" y1="100" x2="400" y2="100"/>
    <line x1="0" y1="200" x2="400" y2="200"/>
    <line x1="100" y1="0" x2="100" y2="300"/>
    <line x1="200" y1="0" x2="200" y2="300"/>
    <line x1="300" y1="0" x2="300" y2="300"/>
  </g>

  <!-- Path using the offset viewBox marker -->
  <path id="testPath"
        d="M 50 100 L 200 100"
        stroke="black"
        stroke-width="2"
        fill="none"
        marker-end="url(#centerMarker)"/>

  <!-- Path using the origin viewBox marker (for comparison) -->
  <path id="comparePath"
        d="M 50 200 L 200 200"
        stroke="black"
        stroke-width="2"
        fill="none"
        marker-end="url(#originMarker)"/>

  <!-- Reference point where the marker center SHOULD land -->
  <!-- This red circle should be perfectly centered in the blue marker circle -->
  <circle id="refPoint1" cx="200" cy="100" r="3" fill="red"/>
  <circle id="refPoint2" cx="200" cy="200" r="3" fill="red"/>

  <!-- Labels -->
  <text x="10" y="90" font-size="12" fill="#666">viewBox="10 20 100 100" (offset origin)</text>
  <text x="10" y="190" font-size="12" fill="#666">viewBox="0 0 100 100" (zero origin - reference)</text>
  <text x="210" y="95" font-size="10" fill="red">Expected center (200,100)</text>
  <text x="210" y="195" font-size="10" fill="red">Expected center (200,200)</text>
</svg>
